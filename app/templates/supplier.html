{% extends "base.html" %}

{% block title %}Data Supplier{% endblock %}

{% block content %}
<div class="container mt-2">
    <h2 class="text-center text-primary"><i class="fas fa-truck"></i> Data Supplier</h2>
    <p class="text-center text-muted">Manage supplier information</p>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="mt-3">
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="row mt-6">
        <!-- Form Input Supplier -->
        <div class="col-md-6">
            <div class="card shadow-sm border-primary">
                <div class="card-body">
                    <h5 class="card-title text-center text-primary"><i class="fas fa-pencil-alt"></i> Input Supplier</h5>
                    <form id="supplierForm" method="POST" action="{% if edit_supplier %}/supplier/edit/{{ edit_supplier.id }}{% else %}/supplier{% endif %}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group">
                            <label for="name"><i class="fas fa-user"></i> Nama Supplier</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Nama Supplier" value="{% if edit_supplier %}{{ edit_supplier.name }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="address"><i class="fas fa-map-marker-alt"></i> Alamat</label>
                            <input type="text" class="form-control" id="address" name="address" placeholder="Alamat" value="{% if edit_supplier %}{{ edit_supplier.address }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="phone"><i class="fas fa-phone"></i> No Telp</label>
                            <input type="text" class="form-control" id="phone" name="phone" placeholder="No Telp" value="{% if edit_supplier %}{{ edit_supplier.phone }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="bank_account"><i class="fas fa-university"></i> No Rekening Bank</label>
                            <input type="text" class="form-control" id="bank_account" name="bank_account" placeholder="No Rekening Bank" value="{% if edit_supplier %}{{ edit_supplier.bank_account }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="account_name"><i class="fas fa-user-circle"></i> Nama Rekening</label>
                            <input type="text" class="form-control" id="account_name" name="account_name" placeholder="Nama Rekening" value="{% if edit_supplier %}{{ edit_supplier.account_name }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="contact_person"><i class="fas fa-user-tie"></i> Kontak Person</label>
                            <input type="text" class="form-control" id="contact_person" name="contact_person" placeholder="Kontak Person" value="{% if edit_supplier %}{{ edit_supplier.contact_person }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="Email" value="{% if edit_supplier %}{{ edit_supplier.email }}{% endif %}" required>
                        </div>
                        <div class="form-group">
                            <label for="website"><i class="fas fa-globe"></i> Website</label>
                            <input type="text" class="form-control" id="website" name="website" placeholder="Website" value="{% if edit_supplier %}{{ edit_supplier.website }}{% endif %}">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            {% if edit_supplier %}<i class="fas fa-save"></i> Update Supplier {% else %}<i class="fas fa-save"></i> Simpan {% endif %}
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Tampil Data Supplier -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-list"></i> Data Supplier</h5>
                    <div class="form-group">
                        <input type="text" class="form-control" id="searchSupplier" placeholder="Cari Data Supplier">
                    </div>
                    <div>
                        <a href="/supplier/export" class="btn btn-success mb-3"><i class="fas fa-file-excel"></i> Export to Excel</a>
                    </div>
                    <div>
                        <form action="/supplier/import" method="POST" enctype="multipart/form-data" class="mb-3">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="form-group">
                                <label for="file"><i class="fas fa-file-excel"></i> Import from Excel</label>
                                <input type="file" class="form-control-file" id="file" name="file" accept=".xlsx, .xls" required>
                            </div>
                            <button type="submit" class="btn btn-primary"><i class="fas fa-upload"></i> Import</button>
                        </form>
                    </div>                    
                    <table class="table table-bordered table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th>Nama</th>
                                <th>Kontak</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <!-- Data will be dynamically added here -->
                        <tbody id="supplierTable">
                            <!-- Data will be dynamically added here -->
                            {% for supplier in suppliers %}
                            <tr>
                                <td><a href="/supplier/{{ supplier.id }}" class="text-primary">{{ supplier.name }}</a></td>
                                <td>{{ supplier.contact_person }}</td>
                                <td>
                                    <a href="/supplier/edit/{{ supplier.id }}" class="btn btn-sm btn-warning"><i class="fas fa-edit"></i> Edit</a>
                                    <form action="/supplier/delete/{{ supplier.id }}" method="POST" style="display:inline;">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="btn btn-sm btn-danger"><i class="fas fa-trash"></i> Delete</button>
                                    </form>
                                    
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        
                    </table>
                    <button class="btn btn-secondary" onclick="window.location.href='/dashboard'"><i
                            class="fas fa-arrow-left"></i> Back to Dashboard</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchSupplier').addEventListener('input', function () {
        const query = this.value.toLowerCase();
        const rows = document.querySelectorAll('#supplierTable tr');
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const match = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(query));
            row.style.display = match ? '' : 'none';
        });
    });
</script>

<style>
    h2 {
        font-weight: bold;
        color: #007bff;
    }

    .card {
        border: none;
        border-radius: 10px;
    }

    .btn {
        margin-top: 10px;
    }
</style>
{% endblock %}
