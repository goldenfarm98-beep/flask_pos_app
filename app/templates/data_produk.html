{% extends "base.html" %}

{% block title %}Data Produk{% endblock %}

{% block content %}
{% set form_prefill = prefill_data if prefill_data else None %}
{% set produk_stat = stat_cards|first if stat_cards else None %}

<div class="adminkit-products">
    <div class="d-flex align-items-start justify-content-between flex-wrap mb-4">
        <div class="mb-2">
            <h1 class="h3 fw-bold mb-1">Master Data Produk</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb ak-breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Produk</li>
                </ol>
            </nav>
            <p class="text-muted mb-0">
                {% if produk_stat %}Produk aktif: {{ '{:,}'.format(produk_stat.value).replace(',', '.') }}.{% endif %}
                Kelola katalog, export, dan import data produk.
            </p>
        </div>
        <div class="btn-group ak-actions">
            <a href="#produk-form-card" class="btn btn-sm btn-primary"><i class="fas fa-plus-circle me-1"></i>Produk baru</a>
            <a href="{{ url_for('main.export_produk') }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-file-download me-1"></i>Export</a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm btn-outline-secondary"><i class="fas fa-th-large me-1"></i>Dashboard</a>
        </div>
    </div>

{% if stat_cards %}
<div class="row stat-grid mb-4">
    {% for card in stat_cards %}
        <div class="col-sm-6 col-xl-3 mb-3">
            <div class="card stat-card h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <span class="stat-icon {{ card.accent }}">
                            <i class="fas {{ card.icon }}"></i>
                        </span>
                        <span class="badge rounded-pill badge-soft-primary text-uppercase fw-semibold px-3">{{ card.label }}</span>
                    </div>
                    <div class="stat-value mb-1">
                        {{ '{:,}'.format(card.value).replace(',', '.') }}
                    </div>
                    <p class="small text-muted mb-0">{{ card.description }}</p>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="row align-items-start">
    <div class="col-lg-8">
        <div class="card card-panel shadow-sm mb-4">
            <div class="card-header bg-white d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                <div>
                    <h2 class="h5 fw-bold mb-1">Daftar Produk</h2>
                    <p class="small text-muted mb-0">Menampilkan {{ pagination.total }} produk sesuai filter yang dipilih.</p>
                </div>
                <a href="{{ url_for('main.produk') }}" class="btn btn-sm btn-outline-primary mt-3 mt-md-0">
                    <i class="fas fa-sync-alt me-1"></i>Reset filter
                </a>
            </div>
            <div class="card-body">
                <form class="filter-form mb-4" method="GET" action="{{ url_for('main.produk') }}">
                    <div class="row align-items-center">
                        <div class="col-12 col-lg-5 mb-3">
                            <label for="filterSearch" class="visually-hidden">Cari Produk</label>
                            <div class="filter-search-wrapper position-relative">
                                <div class="input-group shadow-sm filter-input">
                                    <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                                    <input type="text" id="filterSearch" name="search" class="form-control border-start-0" placeholder="Cari nama, kode, atau SKU" value="{{ request.args.get('search', '') }}" autocomplete="off">
                                </div>
                                <div class="filter-suggestion-panel shadow-sm" id="filterSearchSuggestions"></div>
                            </div>
                        </div>
                        <div class="col-6 col-lg-3 mb-3">
                            <label for="filterKategori" class="visually-hidden">Kategori</label>
                            <div class="input-group shadow-sm filter-input">
                                <span class="input-group-text bg-white border-end-0"><i class="fas fa-tags text-muted"></i></span>
                                <select id="filterKategori" name="kategori" class="form-select border-start-0">
                                    <option value="">Semua kategori</option>
                                    {% for kategori in kategoris %}
                                        <option value="{{ kategori.id }}" {% if request.args.get('kategori') == kategori.id|string %}selected{% endif %}>{{ kategori.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-6 col-lg-3 mb-3">
                            <label for="filterSupplier" class="visually-hidden">Supplier</label>
                            <div class="input-group shadow-sm filter-input">
                                <span class="input-group-text bg-white border-end-0"><i class="fas fa-truck text-muted"></i></span>
                                <select id="filterSupplier" name="supplier" class="form-select border-start-0">
                                    <option value="">Semua supplier</option>
                                    {% for supplier in suppliers %}
                                        <option value="{{ supplier.id }}" {% if request.args.get('supplier') == supplier.id|string %}selected{% endif %}>{{ supplier.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-lg-1 mb-3 d-flex align-items-center justify-content-lg-end">
                            <div class="btn-group btn-group-sm filter-actions w-100" role="group">
                                <button type="submit" class="btn btn-primary btn-icon btn-search-only" data-bs-toggle="tooltip" title="Cari produk">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <div id="productTableContainer">
                    {% include 'partials/product_table.html' %}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h3 class="h6 fw-bold mb-3">Kesehatan data produk</h3>
                        {% set badge_map = {'warning': 'bg-warning text-dark', 'info': 'bg-info text-white', 'success': 'bg-success text-white', 'secondary': 'bg-secondary text-white'} %}
                        <ul class="list-unstyled mb-0">
                            {% for insight in health_insights %}
                                <li class="mb-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <span class="fw-semibold">{{ insight.title }}</span>
                                        <span class="badge rounded-pill {{ badge_map.get(insight.status, 'bg-secondary text-white') }}">
                                            {{ '{:,}'.format(insight.value).replace(',', '.') }}
                                        </span>
                                    </div>
                                    <p class="small text-muted mb-0">{{ insight.description }}</p>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h3 class="h6 fw-bold mb-3">Mendekati kadaluarsa</h3>
                        {% if expiring_products %}
                            <ul class="list-group list-group-flush">
                                {% for produk in expiring_products %}
                                    <li class="list-group-item px-0 d-flex justify-content-between align-items-start">
                                        <div>
                                            <div class="fw-semibold">{{ produk.nama_produk }}</div>
                                            <small class="text-muted d-block">
                                                <i class="fas fa-barcode me-1"></i>{{ produk.kode_produk }}
                                            </small>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-danger mb-1">
                                                {{ produk.tanggal_expired.strftime('%d %b %Y') }}
                                            </span>
                                            <div class="small text-muted">
                                                {{ produk.supplier.name if produk.supplier else 'Supplier tidak ada' }}
                                            </div>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="small text-muted mb-0">Belum ada produk dengan tanggal kedaluwarsa yang tercatat. Tambahkan tanggal pada produk sensitif.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4" id="produk-form-card">
        <div class="sticky-column">
        <div class="card shadow-lg form-card mb-4">
            <div class="card-body">
                <span class="badge rounded-pill bg-primary text-uppercase px-3 py-2" id="productFormBadge" data-default-text="Produk Baru" data-edit-text="Perbarui Produk">
                    {% if edit_produk %}Perbarui Produk{% else %}Produk Baru{% endif %}
                </span>
                <h2 class="h5 fw-bold mt-3 mb-2">
                    <span id="productFormHeading" data-default-text="Tambah produk ke katalog" data-edit-text="Ubah detail">
                        {% if edit_produk %}
                            Ubah detail
                        {% else %}
                            Tambah produk ke katalog
                        {% endif %}
                    </span>
                    <span id="productFormHeadingName" class="text-primary {% if not edit_produk %}d-none{% endif %}">
                        {% if edit_produk %}{{ edit_produk.nama_produk }}{% endif %}
                    </span>
                </h2>
                <p class="small text-muted">Lengkapi informasi utama untuk mempercepat proses penjualan dan analitik stok.</p>

                <div id="productFormEditAlert" class="alert alert-info small {% if not edit_produk %}d-none{% endif %}" role="alert">
                    Anda sedang mengedit produk. Simpan perubahan atau <a href="{{ url_for('main.produk') }}" class="alert-link">batalkan untuk kembali menambah produk baru</a>.
                </div>

                <div class="alert alert-light border small d-flex align-items-start bg-white text-dark" role="alert" style="box-shadow: 0 4px 18px rgba(15,23,42,0.08);">
                    <i class="fas fa-layer-group text-primary me-2 mt-1"></i>
                    <div>
                        Data satuan dan kategori diambil dari master. Kelola pilihan baru melalui halaman
                        <a href="{{ url_for('main.satuan') }}" class="fw-semibold">Data Satuan</a>
                        atau
                        <a href="{{ url_for('main.kategori') }}" class="fw-semibold">Data Kategori</a>.
                    </div>
                </div>

                <form method="POST" id="productForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="produk_id" value="{% if edit_produk %}{{ edit_produk.id }}{% endif %}">

                    <div class="form-group">
                        <label for="kode_produk">Kode Produk</label>
                        <input type="text" class="form-control" id="kode_produk" name="kode_produk" placeholder="Contoh: BRG-001" value="{% if form_prefill and form_prefill.kode_produk is not none %}{{ form_prefill.kode_produk }}{% elif edit_produk %}{{ edit_produk.kode_produk }}{% else %}{% endif %}" required>
                    </div>
                    <div class="form-group">
                        <label for="sku">SKU</label>
                        <input type="text" class="form-control" id="sku" name="sku" placeholder="Opsional: SKU internal" value="{% if form_prefill and form_prefill.sku is not none %}{{ form_prefill.sku }}{% elif edit_produk %}{{ edit_produk.sku }}{% else %}{% endif %}">
                    </div>
                    <div class="form-group">
                        <label for="barcode">Barcode</label>
                        <input type="text" class="form-control" id="barcode" name="barcode" placeholder="Kode barcode" value="{% if form_prefill and form_prefill.barcode is not none %}{{ form_prefill.barcode }}{% elif edit_produk %}{{ edit_produk.barcode }}{% else %}{% endif %}">
                    </div>
                    <div class="form-group">
                        <label for="nama_produk">Nama Produk</label>
                        <input type="text" class="form-control" id="nama_produk" name="nama_produk" placeholder="Nama produk" value="{% if form_prefill and form_prefill.nama_produk is not none %}{{ form_prefill.nama_produk }}{% elif edit_produk %}{{ edit_produk.nama_produk }}{% else %}{% endif %}" required>
                    </div>

                    <div class="row g-3">
                        <div class="form-group col-sm-6">
                            <label for="satuan">Satuan</label>
                            <select class="form-select" id="satuan" name="satuan" required>
                                {% if satuans %}
                                    {% for satuan in satuans %}
                                        <option value="{{ satuan.id }}" title="{{ satuan.name }}" {% if (form_prefill and form_prefill.satuan|int == satuan.id) or (not form_prefill and edit_produk and satuan.id == edit_produk.satuan_id) %}selected{% endif %}>{{ satuan.name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="" disabled selected>Belum ada data satuan</option>
                                {% endif %}
                            </select>
                            <small class="form-text text-muted">Tidak menemukan opsi? Tambahkan di <a href="{{ url_for('main.satuan') }}">Data Satuan</a>.</small>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="kategori">Kategori</label>
                            <select class="form-select" id="kategori" name="kategori" required>
                                {% if kategoris %}
                                    {% for kategori in kategoris %}
                                        <option value="{{ kategori.id }}" title="{{ kategori.name }}" {% if (form_prefill and form_prefill.kategori|int == kategori.id) or (not form_prefill and edit_produk and kategori.id == edit_produk.kategori_id) %}selected{% endif %}>{{ kategori.name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="" disabled selected>Belum ada data kategori</option>
                                {% endif %}
                            </select>
                            <small class="form-text text-muted">Atur daftar kategori di <a href="{{ url_for('main.kategori') }}">Data Kategori</a>.</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="supplier">Supplier</label>
                        <select class="form-select" id="supplier" name="supplier">
                            {% for supplier in suppliers %}
                                <option value="{{ supplier.id }}" title="{{ supplier.name }}" {% if (form_prefill and form_prefill.supplier|int == supplier.id) or (not form_prefill and edit_produk and supplier.id == edit_produk.supplier_id) %}selected{% endif %}>{{ supplier.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="row g-3">
                        <div class="form-group col-sm-6">
                            <label for="berat">Berat (kg)</label>
                            <input type="number" step="0.01" class="form-control" id="berat" name="berat" placeholder="cth. 0.25" value="{% if form_prefill and form_prefill.berat is not none %}{{ form_prefill.berat }}{% elif edit_produk and edit_produk.berat is not none %}{{ edit_produk.berat }}{% else %}{% endif %}">
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="stok_minimal">Stok Minimal</label>
                            <input type="number" class="form-control" id="stok_minimal" name="stok_minimal" placeholder="cth. 10" value="{% if form_prefill and form_prefill.stok_minimal is not none %}{{ form_prefill.stok_minimal }}{% elif edit_produk and edit_produk.stok_minimal is not none %}{{ edit_produk.stok_minimal }}{% else %}{% endif %}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="tanggal_expired">Tanggal Kedaluwarsa</label>
                        <input type="date" class="form-control" id="tanggal_expired" name="tanggal_expired" value="{% if form_prefill and form_prefill.tanggal_expired %}{{ form_prefill.tanggal_expired }}{% elif edit_produk and edit_produk.tanggal_expired %}{{ edit_produk.tanggal_expired.strftime('%Y-%m-%d') }}{% endif %}">
                        <small class="form-text text-muted">Opsional: penting untuk produk makanan, kosmetik, dan obat.</small>
                    </div>

                    <div class="price-level-manager border rounded-3 p-3 mb-4">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <h3 class="h6 fw-bold mb-1">Level harga produk</h3>
                                <p class="small text-muted mb-0">Atur harga Retail, marketplace, dan kanal lain dengan cepat.</p>
                            </div>
                            <a href="{{ url_for('main.harga_level') }}" class="btn btn-link btn-sm px-0">
                                <i class="fas fa-layer-group me-1"></i>Kelola level
                            </a>
                        </div>
                        {% if price_levels %}
                            <div class="row g-3 align-items-end">
                                <div class="form-group col-sm-6 mb-3 mb-sm-0">
                                    <label for="price_level_selector">Pilih level</label>
                                    <select class="form-select" id="price_level_selector">
                                        <option value="">Pilih level</option>
                                        {% for level in price_levels %}
                                            <option value="{{ level.id }}">{{ level.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group col-sm-6">
                                    <label for="price_level_value">Harga (Rp)</label>
                                    <input type="text" class="form-control" id="price_level_value" placeholder="cth. 68.000">
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm w-100" id="add_price_level_entry">
                                <i class="fas fa-plus-circle me-1"></i>Tambahkan level harga
                            </button>
                            <div id="price-level-feedback" class="text-danger small mt-2 d-none"></div>
                            <div class="table-responsive mt-3">
                                <table class="table table-sm mb-0" id="price-level-table">
                                    <thead>
                                        <tr>
                                            <th>Level</th>
                                            <th class="text-end">Harga</th>
                                            <th class="text-end">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-warning small mb-0">
                                Belum ada level harga. Buat minimal satu di halaman <a href="{{ url_for('main.harga_level') }}">Level Harga</a> sebelum menyimpan produk.
                            </div>
                        {% endif %}
                        <input type="hidden" name="price_level_payload" id="price_level_payload_input" value="[]">
                    </div>

                    <button type="submit" class="btn btn-primary w-100" id="productFormSubmit" data-default-label="Simpan Produk" data-edit-label="Simpan Perubahan">
                        {% if edit_produk %}Simpan Perubahan{% else %}Simpan Produk{% endif %}
                    </button>
                    {% if edit_produk %}
                        <a href="{{ url_for('main.produk') }}" class="btn btn-light w-100 mt-2">Batalkan edit</a>
                    {% else %}
                        <button type="reset" class="btn btn-outline-secondary w-100 mt-2">Reset form</button>
                    {% endif %}
                    <button type="button" class="btn btn-light w-100 mt-2 d-none" id="productCancelEditButton" data-reset-url="{{ url_for('main.produk') }}">
                        Batalkan edit
                    </button>

                    <p class="small text-muted text-center mt-3 mb-0">
                        Gunakan kode produk unik untuk memudahkan pelacakan di laporan penjualan.
                    </p>
                </form>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="h6 fw-bold mb-2">Impor dari Excel</h3>
                <p class="small text-muted mb-3">Gunakan file berekstensi .xlsx dengan kolom sesuai template berikut.</p>
                <div class="table-responsive mb-3">
                    <table class="table table-sm table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Kolom</th>
                                <th>Wajib</th>
                                <th>Keterangan</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for field in product_import_schema %}
                            <tr>
                                <td class="fw-semibold">{{ field.column }}</td>
                                <td>
                                    {% if field.required %}
                                        <span class="badge bg-danger">Ya</span>
                                    {% else %}
                                        <span class="badge bg-light text-muted">Opsional</span>
                                    {% endif %}
                                </td>
                                <td class="small text-muted">{{ field.description }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <form action="{{ url_for('main.import_produk') }}" method="POST" enctype="multipart/form-data" id="produkImportForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <label for="importFile" class="form-label mb-1">File Excel</label>
                    <input type="file" class="form-control" id="importFile" name="file" accept=".xls,.xlsx" required>
                    <small id="import-file-name" class="text-muted d-block mt-2">Belum ada file dipilih.</small>
                    <button type="submit" class="btn btn-outline-primary w-100 mt-3" id="produkImportSubmit">
                        <i class="fas fa-file-import me-2"></i>Impor data
                    </button>
                    <div class="mt-3 d-none" id="importProgressWrapper">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="small text-muted">Mengunggah & memproses file...</span>
                            <span class="small fw-semibold" id="importProgressLabel">0%</span>
                        </div>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 0%;" id="importProgressBar" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted d-block mt-2" id="importProgressMessage">Menyiapkan import...</small>
                    </div>
                </form>
                <a href="{{ url_for('main.export_produk') }}" class="btn btn-link btn-sm px-0 mt-3">
                    <i class="fas fa-download me-1"></i>Unduh backup produk terbaru
                </a>
            </div>
        </div>
        </div>
    </div>
</div>
</div>

<style>
    .adminkit-products {
        --ak-card-border: rgba(15, 23, 42, 0.08);
        --ak-card-shadow: 0 0.25rem 0.75rem rgba(15, 23, 42, 0.08);
        --ak-muted: #6b7280;
        --ak-head: #0f172a;
        --ak-primary: #3b7ddd;
        --ak-primary-contrast: #1d4ed8;
    }
    .adminkit-products .ak-breadcrumb {
        background: transparent;
        padding: 0;
        font-size: 0.9rem;
    }
    .adminkit-products .breadcrumb-item + .breadcrumb-item::before {
        content: "â€º";
        color: var(--ak-muted);
    }
    .adminkit-products .card {
        border-radius: 14px;
        border: 1px solid var(--ak-card-border);
        box-shadow: var(--ak-card-shadow);
    }
    .adminkit-products .card-header {
        background: transparent !important;
        border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }
    .adminkit-products .ak-actions .btn {
        border-radius: 999px;
    }
    .hero-card {
        border-radius: 20px;
        padding: 2.5rem 2rem;
    }
    .hero-card .btn {
        border-radius: 999px;
    }
    .hero-meta .badge {
        letter-spacing: 0.08em;
    }
    .text-white-75 {
        color: rgba(255, 255, 255, 0.75) !important;
    }
    .stat-card {
        border-radius: 14px;
        border: 1px solid rgba(15, 23, 42, 0.08);
        box-shadow: 0 0.35rem 1rem rgba(15, 23, 42, 0.08);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.6rem 1.4rem rgba(15, 23, 42, 0.12);
    }
    .stat-card .stat-icon {
        font-size: 1.4rem;
        width: 44px;
        height: 44px;
        border-radius: 14px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(15, 23, 42, 0.06);
        color: #0f172a;
    }
    .stat-card .stat-icon.text-primary {
        background: rgba(59, 125, 221, 0.14);
        color: #3b7ddd;
    }
    .stat-card .stat-icon.text-success {
        background: rgba(16, 185, 129, 0.14);
        color: #059669;
    }
    .stat-card .stat-icon.text-warning {
        background: rgba(245, 158, 11, 0.18);
        color: #b45309;
    }
    .stat-card .stat-icon.text-info {
        background: rgba(14, 165, 233, 0.14);
        color: #0284c7;
    }
    .stat-card .stat-value {
        font-size: 1.7rem;
        font-weight: 700;
    }
    .card-panel {
        border-radius: 14px;
    }
    .adminkit-products .ak-table thead th {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: #475569;
        border-top: none;
        border-bottom: 1px solid rgba(15, 23, 42, 0.12);
        background: #f8fafc;
        white-space: nowrap;
    }
    .adminkit-products .ak-table tbody td {
        vertical-align: middle;
    }
    .adminkit-products .ak-table tbody tr:hover {
        background-color: rgba(59, 125, 221, 0.06);
    }
    .empty-icon {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(37, 99, 235, 0.12);
    }
    .form-card {
        border-radius: 20px;
    }
    select.form-control,
    select.custom-select {
        min-height: 46px;
    }
    select.form-control option,
    select.custom-select option {
        white-space: normal;
    }
    .sticky-column {
        position: sticky;
        top: 1.25rem;
    }
    .sticky-column .card + .card {
        margin-top: 1.5rem;
    }
    .filter-input .input-group-text {
        padding: 0.55rem 0.75rem;
        border-radius: 12px 0 0 12px;
    }
    .filter-input .form-control {
        padding: 0.55rem 0.75rem;
        border-radius: 0 12px 12px 0;
        font-size: 0.95rem;
    }
    .filter-search-wrapper {
        position: relative;
    }
    .filter-suggestion-panel {
        position: absolute;
        left: 0;
        right: 0;
        top: calc(100% + 6px);
        background: #fff;
        border-radius: 12px;
        border: 1px solid rgba(15, 23, 42, 0.08);
        max-height: 260px;
        overflow-y: auto;
        z-index: 20;
        padding: 6px;
        display: none;
    }
    .filter-suggestion-panel.is-visible {
        display: block;
    }
    .filter-suggestion-item {
        width: 100%;
        text-align: left;
        border: none;
        background: transparent;
        padding: 0.6rem 0.65rem;
        border-radius: 10px;
        transition: background 0.2s ease;
        font-size: 0.92rem;
        color: #0f172a;
    }
    .filter-suggestion-item + .filter-suggestion-item {
        margin-top: 4px;
    }
    .filter-suggestion-item:hover,
    .filter-suggestion-item:focus-visible {
        background: rgba(59, 130, 246, 0.08);
    }
    .filter-suggestion-item strong {
        display: block;
        font-weight: 600;
    }
    .filter-suggestion-item span {
        font-size: 0.82rem;
        color: #475569;
    }
    .filter-actions .btn {
        height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    .filter-actions {
        display: inline-flex;
        align-items: center;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
    }
    .filter-actions .btn {
        border-radius: 0;
        box-shadow: none;
        width: 56px;
    }
    .filter-actions .btn:first-child {
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
    }
    .filter-actions .btn:last-child {
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
    }
    .btn-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border-radius: 12px;
        font-size: 1rem;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .filter-actions .btn-icon {
        border-radius: 10px;
    }
    .filter-actions .btn-icon + .btn-icon {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
    .btn-icon:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 24px rgba(15, 23, 42, 0.16);
    }
    .price-level-manager {
        background: #f8fafc;
        border-radius: 16px;
    }
    .price-level-manager table th,
    .price-level-manager table td {
        vertical-align: middle;
    }
    .price-badge-stack {
        gap: 0.35rem;
    }
    .badge-soft-primary {
        background-color: rgba(59, 125, 221, 0.14);
        color: var(--ak-primary-contrast);
        font-weight: 600;
        border-radius: 999px;
        padding: 0.35rem 0.75rem;
    }
    @media (max-width: 992px) {
        .sticky-column {
            position: static;
            top: auto;
        }
    }
    @media (max-width: 576px) {
        .hero-card {
            border-radius: 16px;
            padding: 2rem 1.5rem;
        }
        .stat-card .stat-value {
            font-size: 1.6rem;
        }
    }
</style>

<script>
    const PRICE_LEVEL_SEED = {{ edit_price_levels|default([], true)|tojson }};
    const PRICE_LEVEL_OPTIONS = {{ price_levels_context|default([], true)|tojson }};
    const PRODUCT_FORM_FOCUS = {{ focus_field|default('', true)|tojson }};

    (function initPriceLevelManager() {
        const payloadInput = document.getElementById('price_level_payload_input');
        if (!payloadInput) {
            window.productPriceLevelManager = {
                setRows: () => {},
                getRows: () => [],
            };
            return;
        }

        const tableBody = document.querySelector('#price-level-table tbody');
        const addButton = document.getElementById('add_price_level_entry');
        const levelSelect = document.getElementById('price_level_selector');
        const priceInput = document.getElementById('price_level_value');
        const feedback = document.getElementById('price-level-feedback');

        const normalizeSeed = (seed) =>
            Array.isArray(seed)
                ? seed
                      .map((entry) => ({
                          level_id: Number(entry.level_id),
                          level_name: entry.level_name,
                          price: Number(entry.price) || 0,
                      }))
                      .filter((entry) => entry.level_id && entry.price >= 0)
                : [];

        if (!tableBody || !addButton || !levelSelect || !priceInput) {
            payloadInput.value = JSON.stringify(normalizeSeed(PRICE_LEVEL_SEED));
            window.productPriceLevelManager = {
                setRows: () => {},
                getRows: () => [],
            };
            return;
        }

        const currencyFormatter =
            typeof Intl !== 'undefined' && Intl.NumberFormat
                ? new Intl.NumberFormat('id-ID', {
                      style: 'currency',
                      currency: 'IDR',
                      maximumFractionDigits: 0,
                  })
                : null;

        const getLevelName = (levelId) => {
            const found = (PRICE_LEVEL_OPTIONS || []).find(
                (item) => Number(item.id) === Number(levelId)
            );
            return (found && found.name) || 'Level';
        };

        const formatCurrency = (value) => {
            if (currencyFormatter) {
                return currencyFormatter.format(value || 0);
            }
            return 'Rp ' + (value || 0).toFixed(0);
        };

        const parsePriceValue = (value) => {
            if (typeof value !== 'string') {
                return null;
            }
            const cleaned = value
                .replace(/rp/gi, '')
                .replace(/\s+/g, '')
                .replace(/[^0-9,.-]/g, '')
                .replace(/\./g, '')
                .replace(',', '.');
            if (!cleaned) {
                return null;
            }
            const parsed = Number(cleaned);
            return Number.isFinite(parsed) ? parsed : null;
        };

        const setFeedback = (message, tone) => {
            if (!feedback) {
                return;
            }
            if (!message) {
                feedback.textContent = '';
                feedback.classList.add('d-none');
                return;
            }
            feedback.textContent = message;
            feedback.classList.remove('d-none', 'text-danger', 'text-warning');
            feedback.classList.add(tone === 'warning' ? 'text-warning' : 'text-danger');
        };

        let rows = normalizeSeed(PRICE_LEVEL_SEED);

        const updatePayload = () => {
            payloadInput.value = JSON.stringify(
                rows.map((entry) => ({
                    level_id: entry.level_id,
                    price: entry.price,
                }))
            );
        };

        const renderRows = () => {
            tableBody.innerHTML = '';
            if (!rows.length) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML =
                    '<td colspan="3" class="text-center text-muted small py-3">Belum ada level harga ditambahkan.</td>';
                tableBody.appendChild(emptyRow);
                updatePayload();
                return;
            }
            rows
                .slice()
                .sort((a, b) =>
                    (a.level_name || '').localeCompare(b.level_name || '')
                )
                .forEach((entry) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class="badge badge-soft-primary">${entry.level_name}</span></td>
                        <td class="text-end fw-semibold">${formatCurrency(entry.price)}</td>
                        <td class="text-end">
                            <button type="button" class="btn btn-link btn-sm p-0 pe-2 price-level-edit text-primary" data-level-id="${entry.level_id}">
                                <i class="fas fa-edit me-1"></i>Edit
                            </button>
                            <button type="button" class="btn btn-link btn-sm p-0 text-danger price-level-remove" data-level-id="${entry.level_id}">
                                <i class="fas fa-trash me-1"></i>Hapus
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            updatePayload();
        };

        const manager = {
            setRows(newRows) {
                rows = normalizeSeed(newRows);
                if (levelSelect) {
                    levelSelect.value = '';
                }
                if (priceInput) {
                    priceInput.value = '';
                }
                setFeedback('');
                renderRows();
            },
            getRows() {
                return rows.map((entry) => ({
                    level_id: entry.level_id,
                    level_name: entry.level_name,
                    price: entry.price,
                }));
            },
        };

        window.productPriceLevelManager = manager;

        addButton.addEventListener('click', function () {
            setFeedback('');
            const levelId = parseInt(levelSelect.value, 10);
            if (!levelId) {
                setFeedback('Pilih level harga terlebih dahulu.');
                return;
            }
            const priceValue = parsePriceValue(priceInput.value);
            if (priceValue === null || priceValue < 0) {
                setFeedback('Isi harga dengan angka yang valid.');
                return;
            }
            const entry = {
                level_id: levelId,
                level_name: getLevelName(levelId),
                price: priceValue,
            };
            const existingIndex = rows.findIndex(
                (item) => item.level_id === levelId
            );
            if (existingIndex >= 0) {
                rows[existingIndex] = entry;
            } else {
                rows.push(entry);
            }
            levelSelect.value = '';
            priceInput.value = '';
            renderRows();
        });

        tableBody.addEventListener('click', function (event) {
            const control = event.target.closest('button[data-level-id]');
            if (!control) {
                return;
            }
            const levelId = parseInt(control.dataset.levelId, 10);
            if (control.classList.contains('price-level-remove')) {
                rows = rows.filter((entry) => entry.level_id !== levelId);
                renderRows();
                return;
            }
            const entry = rows.find((item) => item.level_id === levelId);
            if (!entry) {
                return;
            }
            levelSelect.value = String(entry.level_id);
            priceInput.value = entry.price.toLocaleString('id-ID', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2,
            });
            priceInput.focus();
        });

        renderRows();
    })();
</script>

<script>
    document.addEventListener('change', function (event) {
        if (!event.target || event.target.id !== 'importFile') {
            return;
        }
        var input = event.target;
        var helper = document.getElementById('import-file-name');
        if (input.files && input.files.length > 0) {
            var fileName = input.files[0].name;
            if (helper) {
                helper.textContent = fileName;
                helper.classList.remove('text-muted');
                helper.classList.add('text-primary');
            }
        } else {
            if (helper) {
                helper.textContent = 'Belum ada file dipilih.';
                helper.classList.add('text-muted');
                helper.classList.remove('text-primary');
            }
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const importForm = document.getElementById('produkImportForm');
        const importButton = document.getElementById('produkImportSubmit');
        const importButtonDefaultHtml = importButton ? importButton.innerHTML : '';
        const importProgressWrapper = document.getElementById('importProgressWrapper');
        const importProgressBar = document.getElementById('importProgressBar');
        const importProgressLabel = document.getElementById('importProgressLabel');
        const importProgressMessage = document.getElementById('importProgressMessage');
        const importFileInput = document.getElementById('importFile');
        let importTimer = null;

        const updateImportProgress = (value, message) => {
            if (importProgressWrapper) {
                importProgressWrapper.classList.remove('d-none');
            }
            if (!importProgressBar || !importProgressLabel) return;
            const safeValue = Math.max(0, Math.min(100, Math.round(value)));
            importProgressBar.style.width = `${safeValue}%`;
            importProgressBar.setAttribute('aria-valuenow', String(safeValue));
            importProgressLabel.textContent = `${safeValue}%`;
            if (importProgressMessage && message) {
                importProgressMessage.textContent = message;
            }
        };

        const resetImportButton = () => {
            if (importButton) {
                importButton.disabled = false;
                importButton.innerHTML = importButtonDefaultHtml;
            }
        };

        const startOptimisticProgress = () => {
            if (importButton) {
                importButton.disabled = true;
                importButton.innerHTML =
                    '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Memproses import...';
            }
            updateImportProgress(5, 'Mengunggah file...');

            if (importTimer) {
                clearInterval(importTimer);
            }

            let current = 5;
            importTimer = setInterval(() => {
                current = Math.min(current + Math.random() * 12 + 8, 90);
                updateImportProgress(current, 'Memproses data...');
                if (current >= 90) {
                    clearInterval(importTimer);
                }
            }, 400);
        };

        if (importForm) {
            importForm.addEventListener('submit', function () {
                if (!importFileInput || !importFileInput.files || !importFileInput.files.length) {
                    return;
                }
                startOptimisticProgress();
            });
        }

        const filterForm = document.querySelector('.filter-form');
        const tableContainer = document.getElementById('productTableContainer');
        if (!filterForm || !tableContainer) return;

        const requestUrl = filterForm.getAttribute('action');

        function setLoading(active) {
            tableContainer.classList.toggle('is-loading', active);
        }

        function updateHistory(params) {
            const url = new URL(requestUrl, window.location.origin);
            Object.entries(params).forEach(([key, value]) => {
                if (!value) {
                    url.searchParams.delete(key);
                    return;
                }
                if (key === 'ajax') {
                    return;
                }
                url.searchParams.set(key, value);
            });
            window.history.replaceState({}, '', url);
        }

        function loadTable(params = {}) {
            setLoading(true);
            const payload = new URLSearchParams();
            Object.entries(params).forEach(([key, value]) => {
                if (value !== undefined && value !== null) {
                    payload.set(key, value);
                }
            });
            payload.set('ajax', '1');

            fetch(`${requestUrl}?${payload.toString()}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error('Gagal memuat data');
                    }
                    return response.text();
                })
                .then((html) => {
                    tableContainer.innerHTML = html;
                    setLoading(false);
                    updateHistory(params);
                })
                .catch(() => {
                    setLoading(false);
                });
        }

        filterForm.addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = new FormData(filterForm);
            const params = {};
            formData.forEach((value, key) => {
                params[key] = value;
            });
            params.page = 1;
            loadTable(params);
        });

        tableContainer.addEventListener('click', function (event) {
            const link = event.target.closest('.pagination a');
            if (!link) {
                return;
            }
            event.preventDefault();
            const targetUrl = new URL(link.href, window.location.origin);
            const params = {};
            targetUrl.searchParams.forEach((value, key) => {
                params[key] = value;
            });
            loadTable(params);
        });

        const productForm = document.getElementById('productForm');
        const productIdField = productForm
            ? productForm.querySelector('input[name="produk_id"]')
            : null;
        const formBadge = document.getElementById('productFormBadge');
        const formHeading = document.getElementById('productFormHeading');
        const formHeadingName = document.getElementById('productFormHeadingName');
        const editAlert = document.getElementById('productFormEditAlert');
        const cancelButton = document.getElementById('productCancelEditButton');
        const submitButton = document.getElementById('productFormSubmit');
        const priceLevelManager = window.productPriceLevelManager;
        const formCard = document.getElementById('produk-form-card');
        const resetUrl =
            cancelButton?.dataset.resetUrl || '{{ url_for("main.produk") }}';
        const focusFieldName = PRODUCT_FORM_FOCUS;

        if (focusFieldName && productForm) {
            const target = productForm.querySelector(`[name="${focusFieldName}"]`);
            if (target && typeof target.focus === 'function') {
                target.focus();
            }
        }

        const enterFlowFields = [
            'kode_produk',
            'sku',
            'barcode',
            'nama_produk',
            'satuan',
            'kategori',
            'supplier',
            'berat',
            'stok_minimal',
            'tanggal_expired',
            'price_level_selector',
            'price_level_value',
        ];

        if (productForm) {
            productForm.addEventListener('keydown', function (event) {
                if (event.key !== 'Enter') {
                    return;
                }
                const target = event.target;
                if (!target || target.tagName.toLowerCase() === 'textarea') {
                    return;
                }
                const targetType = (target.getAttribute('type') || '').toLowerCase();
                if (targetType === 'submit' || targetType === 'button') {
                    return;
                }
                const name = target.getAttribute('name');
                const currentIndex = enterFlowFields.indexOf(name);
                if (currentIndex === -1) {
                    return;
                }
                event.preventDefault();
                const nextName = enterFlowFields[currentIndex + 1];
                if (nextName) {
                    const nextField = productForm.querySelector(`[name="${nextName}"]`);
                    if (nextField && typeof nextField.focus === 'function') {
                        nextField.focus();
                        return;
                    }
                }
                if (submitButton && typeof submitButton.focus === 'function') {
                    submitButton.focus();
                }
            });
        }

        const applyFormLabels = (isEdit, productName) => {
            if (formBadge) {
                formBadge.textContent = isEdit
                    ? formBadge.dataset.editText || 'Perbarui Produk'
                    : formBadge.dataset.defaultText || 'Produk Baru';
            }
            if (formHeading) {
                formHeading.textContent = isEdit
                    ? formHeading.dataset.editText || 'Ubah detail'
                    : formHeading.dataset.defaultText || 'Tambah produk ke katalog';
            }
            if (formHeadingName) {
                formHeadingName.textContent = productName || '';
                formHeadingName.classList.toggle('d-none', !productName);
            }
            if (editAlert) {
                editAlert.classList.toggle('d-none', !isEdit);
            }
            if (submitButton) {
                submitButton.textContent = isEdit
                    ? submitButton.dataset.editLabel || submitButton.textContent
                    : submitButton.dataset.defaultLabel || submitButton.textContent;
            }
            if (cancelButton) {
                cancelButton.classList.toggle('d-none', !isEdit);
            }
        };

        const fillForm = (payload) => {
            if (!productForm) {
                return;
            }
            if (productIdField) {
                productIdField.value = payload.id;
            }
            const baseValues = {
                kode_produk: payload.kode_produk || '',
                sku: payload.sku || '',
                barcode: payload.barcode || '',
                nama_produk: payload.nama_produk || '',
                satuan: payload.satuan_id || '',
                kategori: payload.kategori_id || '',
                supplier: payload.supplier_id || '',
                berat:
                    payload.berat !== null && payload.berat !== undefined
                        ? payload.berat
                        : '',
                stok_minimal:
                    payload.stok_minimal !== null && payload.stok_minimal !== undefined
                        ? payload.stok_minimal
                        : '',
                tanggal_expired: payload.tanggal_expired || '',
            };
            Object.entries(baseValues).forEach(([name, value]) => {
                const field = productForm.querySelector(`[name="${name}"]`);
                if (field) {
                    field.value = value;
                }
            });

            priceLevelManager?.setRows(payload.price_levels || []);
            applyFormLabels(true, payload.nama_produk || '');
            if (formCard) {
                formCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        const handleEditClick = (event) => {
            const trigger = event.target.closest('[data-product-edit-url]');
            if (!trigger) {
                return;
            }
            event.preventDefault();
            const url = trigger.dataset.productEditUrl;
            if (!url) {
                return;
            }
            fetch(url, {
                headers: {
                    Accept: 'application/json',
                },
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error('Gagal memuat detail produk.');
                    }
                    return response.json();
                })
                .then((payload) => {
                    fillForm(payload);
                })
                .catch((error) => {
                    console.error(error);
                    alert('Gagal memuat detail produk. Silakan coba lagi.');
                });
        };

        tableContainer.addEventListener('click', handleEditClick);

        cancelButton?.addEventListener('click', function () {
            window.location.href = resetUrl;
        });

        const supplierSelect = document.getElementById('filterSupplier');
        const categorySelect = document.getElementById('filterKategori');
        const supplierDefaultOption =
            supplierSelect && supplierSelect.querySelector('option[value=""]');

        const renderSuppliers = (items) => {
            if (!supplierSelect) return;
            const currentValue = supplierSelect.value;
            supplierSelect.innerHTML = '';
            const defaultNode = document.createElement('option');
            defaultNode.value = '';
            defaultNode.textContent = 'Semua supplier';
            supplierSelect.appendChild(defaultNode);
            if (Array.isArray(items)) {
                items.forEach((item) => {
                    const opt = document.createElement('option');
                    opt.value = item.id;
                    opt.textContent = item.name;
                    supplierSelect.appendChild(opt);
                });
            }
            // reset value unless still available
            if (
                currentValue &&
                supplierSelect.querySelector(`option[value="${currentValue}"]`)
            ) {
                supplierSelect.value = currentValue;
            } else {
                supplierSelect.value = '';
            }
        };

        const fetchSuppliers = (kategoriId) => {
            if (!supplierSelect) return;
            supplierSelect.disabled = true;
            fetch(
                `{{ url_for('main.get_suppliers') }}${kategoriId ? '?kategori_id=' + kategoriId : ''}`,
                { headers: { Accept: 'application/json' } }
            )
                .then((res) => {
                    if (!res.ok) throw new Error('fail');
                    return res.json();
                })
                .then((data) => {
                    renderSuppliers(data.suppliers || []);
                })
                .catch(() => {
                    // fallback to default when error
                    renderSuppliers([]);
                })
                .finally(() => {
                    supplierSelect.disabled = false;
                });
        };

        if (categorySelect) {
            categorySelect.addEventListener('change', function () {
                const selected = this.value;
                fetchSuppliers(selected);
            });
            if (categorySelect.value) {
                fetchSuppliers(categorySelect.value);
            }
        }

        const searchInput = document.getElementById('filterSearch');
        const suggestionPanel = document.getElementById('filterSearchSuggestions');
        if (searchInput && suggestionPanel) {
            let debounceTimer = null;
            let abortCtrl = null;

            const hideSuggestions = () => {
                suggestionPanel.classList.remove('is-visible');
                suggestionPanel.innerHTML = '';
            };

            const showSuggestions = () => {
                if (suggestionPanel.innerHTML.trim()) {
                    suggestionPanel.classList.add('is-visible');
                }
            };

            const renderSuggestions = (items) => {
                if (!Array.isArray(items) || !items.length) {
                    suggestionPanel.innerHTML =
                        '<div class="text-muted small px-2 py-2">Tidak ada produk yang cocok.</div>';
                    showSuggestions();
                    return;
                }
                suggestionPanel.innerHTML = '';
                items.slice(0, 10).forEach((item) => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'filter-suggestion-item';
                    btn.innerHTML = `
                        <strong>${item.nama_produk}</strong>
                        <span>${item.kode_produk || '-'} Â· ${item.sku || 'SKU ?'} Â· ${item.barcode || 'Barcode ?'}</span>
                        <span>${item.kategori || 'Kategori ?'}</span>
                    `;
                    btn.addEventListener('click', function () {
                        searchInput.value = item.kode_produk || item.nama_produk || '';
                        hideSuggestions();
                        const params = {
                            search: searchInput.value,
                            kategori: categorySelect ? categorySelect.value : '',
                            supplier: supplierSelect ? supplierSelect.value : '',
                            page: 1,
                        };
                        loadTable(params);
                    });
                    suggestionPanel.appendChild(btn);
                });
                showSuggestions();
            };

            const fetchProducts = (term) => {
                if (abortCtrl) {
                    abortCtrl.abort();
                }
                abortCtrl = new AbortController();
                fetch(
                    `{{ url_for('main.get_products') }}?q=${encodeURIComponent(term)}`,
                    {
                        headers: { Accept: 'application/json' },
                        signal: abortCtrl.signal,
                    }
                )
                    .then((res) => {
                        if (!res.ok) {
                            throw new Error('fail');
                        }
                        return res.json();
                    })
                    .then((data) => {
                        renderSuggestions(data.products || []);
                    })
                    .catch((err) => {
                        if (err.name === 'AbortError') return;
                        suggestionPanel.innerHTML =
                            '<div class="text-danger small px-2 py-2">Gagal memuat saran.</div>';
                        showSuggestions();
                    });
            };

            searchInput.addEventListener('input', function () {
                const term = this.value.trim();
                if (!term) {
                    hideSuggestions();
                    return;
                }
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    fetchProducts(term);
                }, 250);
            });

            searchInput.addEventListener('focus', function () {
                showSuggestions();
            });

            document.addEventListener('click', function (event) {
                if (
                    event.target !== searchInput &&
                    !suggestionPanel.contains(event.target)
                ) {
                    hideSuggestions();
                }
            });
        }
    });
</script>

<style>
    #productTableContainer {
        position: relative;
    }

    #productTableContainer.is-loading::after {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(2px);
        z-index: 10;
    }
</style>
{% endblock %}
