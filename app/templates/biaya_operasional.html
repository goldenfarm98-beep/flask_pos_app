{% extends "base.html" %}

{% block title %}Biaya Operasional{% endblock %}

{% block content %}
<section class="expense-module">
    <div class="card shadow-sm border-0 mb-4 hero-card">
        <div class="card-body d-flex flex-column flex-lg-row align-items-lg-center">
            <div class="flex-fill pr-lg-4">
                <p class="eyebrow text-uppercase mb-2">Biaya Operasional</p>
                <h1 class="display-5 mb-2 text-navy">Catat pengeluaran harian tanpa jurnal manual</h1>
                <p class="mb-0 text-muted">Form ini otomatis membuat jurnal: debit akun beban, kredit kas/bank/utang. Cocok untuk biaya sewa, utilitas, pemasaran, dan operasional lainnya.</p>
            </div>
            <div class="mt-4 mt-lg-0 text-lg-right">
                <small class="text-uppercase text-muted d-block">Total entri</small>
                <div class="h4 font-weight-bold mb-0">{{ total_entries }}</div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <p class="eyebrow text-uppercase mb-1">Input biaya</p>
                    <h3 class="h5 mb-3">Form biaya operasional</h3>
                    <form method="POST" action="{{ url_for('main.biaya_operasional') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label>Tanggal</label>
                                <input type="date" name="date" class="form-control" value="{{ default_date }}" required>
                            </div>
                            <div class="form-group col-md-8">
                                <label>Nominal</label>
                                <input type="number" name="amount" min="0" step="0.01" class="form-control" placeholder="Contoh: 250000" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label>Akun beban</label>
                                <select name="expense_account" class="custom-select" required>
                                    <option value="">Pilih akun beban</option>
                                    {% for account in expense_accounts %}
                                        <option value="{{ account.id }}">{{ account.code }} - {{ account.name }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">Daftar akun beban diambil dari menu <a href="{{ url_for('main.akun') }}">Data Akun</a>.</small>
                            </div>
                            <div class="form-group col-md-6">
                                <label>Akun pembayaran</label>
                                <select name="payment_account" class="custom-select" required>
                                    <option value="">Pilih kas/bank/utang</option>
                                    {% for account in payment_accounts %}
                                        <option value="{{ account.id }}">{{ account.code }} - {{ account.name }}</option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">Pilih akun kas, bank, atau utang untuk kredit.</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Catatan (opsional)</label>
                            <input type="text" name="note" class="form-control" placeholder="Contoh: Bayar listrik bulan Desember">
                        </div>
                        <button class="btn btn-primary btn-block">
                            <i class="fas fa-save mr-2"></i>Simpan Biaya
                        </button>
                        <p class="small text-muted mt-2 mb-0">
                            Entri biaya otomatis masuk ke <a href="{{ url_for('main.jurnal') }}">Jurnal Umum</a>.
                        </p>
                    </form>
                    {% if not expense_accounts %}
                        <div class="alert alert-warning mt-3" role="alert">
                            Belum ada akun beban. Tambahkan akun bertipe beban di <a href="{{ url_for('main.akun') }}">Data Akun</a>.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-5 mb-4">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <p class="eyebrow text-uppercase mb-1">Ringkasan</p>
                    <h3 class="h5 mb-3">Total biaya</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <small class="text-muted">Hari ini</small>
                            <div class="summary-value text-danger">Rp {{ ('{:,.0f}'.format(total_today)).replace(',', '.') }}</div>
                        </div>
                        <div class="summary-card">
                            <small class="text-muted">Bulan ini</small>
                            <div class="summary-value">Rp {{ ('{:,.0f}'.format(total_month)).replace(',', '.') }}</div>
                        </div>
                        <div class="summary-card">
                            <small class="text-muted">Total entri</small>
                            <div class="summary-value">{{ total_entries }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card shadow-sm border-0 h-100">
                <div class="card-body">
                    <p class="eyebrow text-uppercase mb-1">Riwayat</p>
                    <h3 class="h5 mb-3">Biaya terbaru</h3>
                    {% if recent_entries %}
                    <div class="history-list">
                        {% for entry in recent_entries %}
                        <div class="history-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="font-weight-semibold">{{ entry.reference }}</div>
                                    <small class="text-muted">{{ entry.date.strftime('%d %b %Y') }} - {{ entry.memo }}</small>
                                </div>
                                <span class="badge badge-light">Rp {{ ('{:,.0f}'.format(entry.amount)).replace(',', '.') }}</span>
                            </div>
                            <div class="small text-muted mt-2">
                                Beban: {{ entry.expense_account.code if entry.expense_account else '-' }} - {{ entry.expense_account.name if entry.expense_account else '-' }}
                            </div>
                            <div class="small text-muted">
                                Pembayaran: {{ entry.payment_account.code if entry.payment_account else '-' }} - {{ entry.payment_account.name if entry.payment_account else '-' }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted mb-0">Belum ada biaya operasional tercatat.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .expense-module .eyebrow { letter-spacing: 0.28em; font-size: 0.72rem; color: #94a3b8; }
    .expense-module .text-navy { color: #0f172a; }
    .expense-module .hero-card { border-radius: 22px; }
    .expense-module .summary-grid { display: grid; gap: 12px; }
    .expense-module .summary-card {
        border-radius: 16px;
        padding: 12px 14px;
        background: #f8fafc;
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.08);
    }
    .expense-module .summary-value { font-size: 1.35rem; font-weight: 700; }
    .expense-module .history-list { display: grid; gap: 14px; }
    .expense-module .history-item {
        padding: 14px;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        background: #fff;
    }
</style>
{% endblock %}
